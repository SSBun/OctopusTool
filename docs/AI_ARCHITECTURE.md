# AI é…ç½®ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

Octopus Dev Tools çš„ AI é…ç½®ç³»ç»Ÿæä¾›äº†ç»Ÿä¸€ã€å¯æ‰©å±•çš„æ¶æ„ï¼Œæ”¯æŒå¤šé…ç½®ç®¡ç†å’Œè·¨å·¥å…·å¤ç”¨ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (UI Components)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚VariableNamingâ”‚  â”‚ CodeGeneratorâ”‚  â”‚  å…¶ä»–AIå·¥å…·  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                  â”‚                  â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                            â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æœåŠ¡å±‚ (Service Layer)                â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                   â”‚   AIService     â”‚                    â”‚
â”‚                   â”‚  (ç»Ÿä¸€è°ƒç”¨æ¥å£)  â”‚                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                            â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 ä¸Šä¸‹æ–‡å±‚ (Context Layer)                 â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                   â”‚ AIConfigContext â”‚                    â”‚
â”‚                   â”‚  (é…ç½®ç®¡ç†)      â”‚                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                            â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  å­˜å‚¨å±‚ (Storage Layer)                  â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                   â”‚  localStorage   â”‚                    â”‚
â”‚                   â”‚ (æœ¬åœ°æŒä¹…åŒ–)     â”‚                    â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ ai.ts                    # AI ç±»å‹å®šä¹‰
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AIConfigContext.tsx      # AI é…ç½®ä¸Šä¸‹æ–‡
â”œâ”€â”€ services/
â”‚   â””â”€â”€ aiService.ts             # ç»Ÿä¸€ AI æœåŠ¡
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AIConfigForm.tsx         # é…ç½®è¡¨å•ç»„ä»¶
â”‚   â””â”€â”€ SettingsDialog.tsx       # é…ç½®ç®¡ç†ç•Œé¢
â””â”€â”€ pages/tools/text/
    â””â”€â”€ VariableNamingTool.tsx   # ç¤ºä¾‹å·¥å…·å®ç°
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. ç±»å‹ç³»ç»Ÿ (`src/types/ai.ts`)

#### AIConfig
å®Œæ•´çš„ AI é…ç½®æ•°æ®ç»“æ„ï¼š

```typescript
interface AIConfig {
  id: string;           // å”¯ä¸€æ ‡è¯†ï¼ˆnanoidï¼‰
  name: string;         // é…ç½®åç§°
  provider: AIProvider; // æœåŠ¡æä¾›å•†
  apiKey: string;       // API å¯†é’¥
  baseUrl: string;      // API åŸºç¡€ URL
  model: string;        // æ¨¡å‹åç§°
  isActive: boolean;    // æ˜¯å¦æ¿€æ´»
  createdAt: number;    // åˆ›å»ºæ—¶é—´
  updatedAt: number;    // æ›´æ–°æ—¶é—´
}
```

#### AIProvider
æ”¯æŒçš„ AI æä¾›å•†ï¼š

```typescript
type AIProvider = 'openai' | 'azure' | 'anthropic' | 'custom';
```

### 2. é…ç½®ç®¡ç† (`src/contexts/AIConfigContext.tsx`)

æä¾›å…¨å±€é…ç½®ç®¡ç†çš„ React Contextï¼š

```typescript
interface AIConfigContextType {
  configs: AIConfig[];                              // æ‰€æœ‰é…ç½®
  activeConfig: AIConfig | null;                    // æ¿€æ´»çš„é…ç½®
  addConfig: (formData: AIConfigFormData) => void;  // æ·»åŠ é…ç½®
  updateConfig: (id: string, data: Partial) => void;// æ›´æ–°é…ç½®
  deleteConfig: (id: string) => void;               // åˆ é™¤é…ç½®
  setActiveConfig: (id: string) => void;            // è®¾ç½®æ¿€æ´»
  getConfigById: (id: string) => AIConfig;          // è·å–é…ç½®
  isConfigured: boolean;                            // æ˜¯å¦å·²é…ç½®
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**

```typescript
import { useAIConfig } from '@/contexts/AIConfigContext';

const MyComponent = () => {
  const { activeConfig, isConfigured, configs } = useAIConfig();
  
  // æ£€æŸ¥æ˜¯å¦å·²é…ç½®
  if (!isConfigured) {
    return <div>è¯·å…ˆé…ç½® AI</div>;
  }
  
  // ä½¿ç”¨æ¿€æ´»çš„é…ç½®...
};
```

### 3. AI æœåŠ¡ (`src/services/aiService.ts`)

ç»Ÿä¸€çš„ AI è°ƒç”¨æœåŠ¡ç±»ï¼š

#### AIService ç±»

```typescript
class AIService {
  constructor(config: AIConfig)
  
  // æµ‹è¯•è¿æ¥
  testConnection(): Promise<AITestResult>
  
  // ç”Ÿæˆæ–‡æœ¬
  generateText(prompt: string, options?: {...}): Promise<string>
  
  // ç”Ÿæˆç»“æ„åŒ–å¯¹è±¡ï¼ˆæ¨èï¼‰
  generateObject<T>(prompt: string, schema: ZodType): Promise<T>
  
  // æµå¼ç”Ÿæˆ
  streamText(prompt: string, options?: {...}): Promise<Stream>
  
  // æ‰¹é‡ç”Ÿæˆ
  generateMultiple<T>(prompts: string[], schema: ZodType): Promise<T[]>
}
```

#### å·¥å‚å‡½æ•°

```typescript
// ä½¿ç”¨æŒ‡å®šé…ç½®åˆ›å»ºæœåŠ¡
createAIService(config: AIConfig): AIService

// ä½¿ç”¨æ¿€æ´»é…ç½®åˆ›å»ºæœåŠ¡ï¼ˆæ¨èï¼‰
createActiveAIService(activeConfig: AIConfig | null): AIService | null
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åŸºç¡€ç”¨æ³•ç¤ºä¾‹

```typescript
import React, { useState } from 'react';
import { useAIConfig } from '@/contexts/AIConfigContext';
import { createActiveAIService } from '@/services/aiService';
import { z } from 'zod';

// 1. å®šä¹‰å“åº” schema
const responseSchema = z.object({
  result: z.string(),
  confidence: z.number(),
});

export const MyAITool = () => {
  const { activeConfig, isConfigured } = useAIConfig();
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState(null);

  const handleGenerate = async (prompt: string) => {
    // 2. åˆ›å»º AI æœåŠ¡å®ä¾‹
    const aiService = createActiveAIService(activeConfig);
    if (!aiService) {
      alert('è¯·å…ˆé…ç½® AI');
      return;
    }

    setLoading(true);
    try {
      // 3. è°ƒç”¨ AI æœåŠ¡
      const data = await aiService.generateObject(prompt, responseSchema);
      setResult(data);
    } catch (error) {
      console.error('AI è°ƒç”¨å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      {/* UI å®ç°... */}
    </div>
  );
};
```

### é«˜çº§ç”¨æ³•ï¼šæµå¼ç”Ÿæˆ

```typescript
const handleStream = async (prompt: string) => {
  const aiService = createActiveAIService(activeConfig);
  if (!aiService) return;

  const stream = await aiService.streamText(prompt, {
    onChunk: (chunk) => {
      // é€å—å¤„ç†è¿”å›çš„æ–‡æœ¬
      setContent(prev => prev + chunk);
    },
  });
};
```

### å¤šé…ç½®ç®¡ç†ç¤ºä¾‹

```typescript
const ToolWithConfigSelector = () => {
  const { configs, activeConfig, setActiveConfig } = useAIConfig();
  const [selectedConfigId, setSelectedConfigId] = useState(activeConfig?.id);

  const handleConfigChange = (configId: string) => {
    setSelectedConfigId(configId);
    setActiveConfig(configId);
  };

  return (
    <Select value={selectedConfigId} onChange={(e) => handleConfigChange(e.target.value)}>
      {configs.map(config => (
        <MenuItem key={config.id} value={config.id}>
          {config.name} ({config.provider})
        </MenuItem>
      ))}
    </Select>
  );
};
```

## ğŸ¨ UI ç»„ä»¶

### AIConfigForm

é…ç½®è¡¨å•ç»„ä»¶ï¼Œç”¨äºæ·»åŠ /ç¼–è¾‘é…ç½®ï¼š

```typescript
<AIConfigForm
  initialData={existingConfig}  // å¯é€‰ï¼šç¼–è¾‘æ—¶ä¼ å…¥
  onSubmit={handleSubmit}
  onCancel={handleCancel}
  submitLabel="ä¿å­˜"             // å¯é€‰ï¼šæŒ‰é’®æ–‡å­—
/>
```

**åŠŸèƒ½ï¼š**
- âœ… è‡ªåŠ¨æ ¹æ®æä¾›å•†è®¾ç½®é»˜è®¤å€¼
- âœ… API Key æ˜¾ç¤º/éšè—åˆ‡æ¢
- âœ… æµ‹è¯•è¿æ¥åŠŸèƒ½
- âœ… å®æ—¶è¡¨å•éªŒè¯

### SettingsDialog

é…ç½®ç®¡ç†ä¸»ç•Œé¢ï¼š

```typescript
<SettingsDialog
  open={open}
  onClose={handleClose}
/>
```

**åŠŸèƒ½ï¼š**
- âœ… é…ç½®åˆ—è¡¨å±•ç¤º
- âœ… æ·»åŠ æ–°é…ç½®
- âœ… ç¼–è¾‘ç°æœ‰é…ç½®
- âœ… åˆ é™¤é…ç½®ï¼ˆå¸¦ç¡®è®¤ï¼‰
- âœ… åˆ‡æ¢æ¿€æ´»é…ç½®
- âœ… é…ç½®çŠ¶æ€æ˜¾ç¤º

## ğŸ” å®‰å…¨æ€§

### æ•°æ®å­˜å‚¨
- æ‰€æœ‰é…ç½®å­˜å‚¨åœ¨æµè§ˆå™¨çš„ `localStorage`
- API Key ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨
- ä»…åœ¨å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨ AI API

### æœ€ä½³å®è·µ
1. å®šæœŸè½®æ¢ API Key
2. ä¸ºä¸åŒç¯å¢ƒåˆ›å»ºä¸åŒé…ç½®
3. ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Key
4. ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æµ‹è¯•é…ç½®

## ğŸš€ æ‰©å±•æ–°å·¥å…·

### æ­¥éª¤ 1: å¼•å…¥ä¾èµ–

```typescript
import { useAIConfig } from '@/contexts/AIConfigContext';
import { createActiveAIService } from '@/services/aiService';
import { z } from 'zod';
```

### æ­¥éª¤ 2: å®šä¹‰ Schema

```typescript
const mySchema = z.object({
  // å®šä¹‰ä½ æœŸæœ›çš„å“åº”ç»“æ„
  data: z.array(z.string()),
  metadata: z.object({
    count: z.number(),
  }),
});
```

### æ­¥éª¤ 3: è°ƒç”¨æœåŠ¡

```typescript
const { activeConfig, isConfigured } = useAIConfig();

const generateData = async () => {
  const aiService = createActiveAIService(activeConfig);
  if (!aiService) {
    // æç¤ºç”¨æˆ·é…ç½®
    return;
  }

  const result = await aiService.generateObject(
    "your prompt here",
    mySchema
  );
  
  // ä½¿ç”¨ç»“æœ...
};
```

## ğŸ“Š é…ç½®ç¤ºä¾‹

### OpenAI
```json
{
  "name": "OpenAI GPT-4",
  "provider": "openai",
  "baseUrl": "https://api.openai.com/v1",
  "apiKey": "sk-...",
  "model": "gpt-4o-mini"
}
```

### Azure OpenAI
```json
{
  "name": "Azure OpenAI",
  "provider": "azure",
  "baseUrl": "https://YOUR_RESOURCE.openai.azure.com",
  "apiKey": "your-azure-key",
  "model": "gpt-4"
}
```

### è‡ªå®šä¹‰ (OpenAI å…¼å®¹)
```json
{
  "name": "æœ¬åœ°æ¨¡å‹",
  "provider": "custom",
  "baseUrl": "http://localhost:11434/v1",
  "apiKey": "dummy",
  "model": "llama2"
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é…ç½®éªŒè¯**
   - æ·»åŠ é…ç½®åå»ºè®®å…ˆæµ‹è¯•è¿æ¥
   - ç¡®ä¿ API Key æœ‰æ•ˆä¸”æœ‰è¶³å¤Ÿé¢åº¦

2. **é”™è¯¯å¤„ç†**
   - å§‹ç»ˆä½¿ç”¨ try-catch åŒ…è£¹ AI è°ƒç”¨
   - æä¾›å‹å¥½çš„é”™è¯¯æç¤º

3. **æ€§èƒ½ä¼˜åŒ–**
   - é¿å…é¢‘ç¹åˆ›å»º AIService å®ä¾‹
   - è€ƒè™‘ç¼“å­˜ç”Ÿæˆç»“æœ
   - ä½¿ç”¨æµå¼ç”Ÿæˆæ”¹å–„ç”¨æˆ·ä½“éªŒ

4. **æˆæœ¬æ§åˆ¶**
   - æ˜¾ç¤º token ä½¿ç”¨æƒ…å†µ
   - è®¾ç½®æœ€å¤§ token é™åˆ¶
   - æä¾›æœ¬åœ°æ¨¡å‹é€‰é¡¹

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬è¿ç§»

å¦‚æœä½ çš„å·¥å…·ä½¿ç”¨æ—§çš„ AI é…ç½®ç³»ç»Ÿï¼š

**ä¹‹å‰ï¼š**
```typescript
import { openai } from '@ai-sdk/openai';
import { generateObject } from 'ai';

const { object } = await generateObject({
  model: openai(config.model, {
    baseURL: config.baseUrl,
    apiKey: config.apiKey,
  }),
  schema,
  prompt,
});
```

**ç°åœ¨ï¼š**
```typescript
import { createActiveAIService } from '@/services/aiService';

const aiService = createActiveAIService(activeConfig);
const result = await aiService.generateObject(prompt, schema);
```

## ğŸ“ æ€»ç»“

- âœ… **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰ AI å·¥å…·ä½¿ç”¨ç›¸åŒçš„æœåŠ¡å±‚
- âœ… **å¤šé…ç½®æ”¯æŒ**ï¼šçµæ´»åˆ‡æ¢ä¸åŒçš„ AI æä¾›å•†å’Œæ¨¡å‹
- âœ… **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°å·¥å…·åªéœ€å‡ è¡Œä»£ç 
- âœ… **æœ¬åœ°ä¼˜å…ˆ**ï¼šæ‰€æœ‰é…ç½®å®‰å…¨å­˜å‚¨åœ¨æœ¬åœ°

## ğŸ¤ è´¡çŒ®

å¦‚æœä½ éœ€è¦æ·»åŠ æ–°çš„ AI æä¾›å•†æ”¯æŒæˆ–æ”¹è¿›ç°æœ‰åŠŸèƒ½ï¼Œè¯·å‚è€ƒï¼š
- `src/types/ai.ts` - æ·»åŠ æ–°çš„æä¾›å•†ç±»å‹
- `src/services/aiService.ts` - å®ç°æä¾›å•†ç‰¹å®šé€»è¾‘
- `DEFAULT_CONFIGS` - æ·»åŠ é»˜è®¤é…ç½®æ¨¡æ¿

