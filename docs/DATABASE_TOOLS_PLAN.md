# 数据库工具规划文档

## 📋 分类调整总结

### 已完成的调整
1. ✅ 在"编程开发"分类下创建了"数据库工具"子分类
2. ✅ 将 SQL 格式化从"代码格式化"迁移到"数据库工具"
3. ✅ 更新了路由：`/tools/dev/sql-formatter` → `/tools/database/sql-formatter`
4. ✅ 创建了 DatabaseTools 列表页面
5. ✅ 导航栏支持自动展开和状态持久化

### 导航结构
```
📁 编程开发 (可折叠)
├── JSON 工具
├── 代码格式化
└── 数据库工具 ⭐ (新增)
```

---

## 🗄️ 数据库工具规划

### 1. SQL 格式化 ✅ (已完成)
**路径**: `/tools/database/sql-formatter`

**功能**:
- 美化和格式化 SQL 语句
- 支持 10 种数据库方言（MySQL、PostgreSQL、SQL Server、Oracle 等）
- 压缩模式
- 历史记录
- 示例加载
- 下载为 .sql 文件

---

### 2. AI SQL 生成器 🤖 (计划中)
**路径**: `/tools/database/ai-sql-generator`

**功能描述**:
- 自然语言描述 → SQL 查询
- 示例：
  - 输入："查询所有活跃用户的订单"
  - 输出：`SELECT * FROM users u INNER JOIN orders o ON u.id = o.user_id WHERE u.status = 'active'`

**核心特性**:
- 支持多种数据库方言
- 提供多个候选 SQL 方案
- 智能优化建议（索引、性能）
- SQL 解释功能（反向：SQL → 自然语言）
- 支持复杂查询（JOIN、子查询、聚合、窗口函数）

**技术实现**:
- 使用 `@vercel/ai` + AI 配置系统
- Zod schema 验证输出
- 提供 SQL 模板库

**UI 设计**:
```
┌─────────────────────────────────────────┐
│ AI SQL 生成器                          │
├─────────────────────────────────────────┤
│ [输入自然语言描述]                     │
│ "查询最近30天订单金额超过1000的用户"   │
│                                         │
│ 数据库: [MySQL ▼]  AI模型: [GPT-4 ▼]  │
│                                         │
│ [生成 SQL]                             │
├─────────────────────────────────────────┤
│ 📝 生成结果 (3个候选)                  │
│ ┌─────────────────────────────────────┐│
│ │ ⭐ 推荐 (评分: 95)                 ││
│ │ SELECT u.id, u.name, ...           ││
│ │ [复制] [优化建议] [解释]           ││
│ └─────────────────────────────────────┘│
│ ┌─────────────────────────────────────┐│
│ │ 备选 1 (评分: 88)                  ││
│ │ ...                                ││
│ └─────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

**优先级**: ⭐⭐⭐⭐⭐ (高)

---

### 3. SQL 转换工具 🔄 (计划中)
**路径**: `/tools/database/sql-converter`

**功能描述**:
数据库方言之间的 SQL 语法转换

**支持的转换**:
- MySQL ↔ PostgreSQL
- MySQL ↔ SQL Server
- PostgreSQL ↔ Oracle
- SQLite → 其他数据库

**核心特性**:
- 数据类型自动映射
- 函数转换（DATE_FORMAT、CONCAT 等）
- 语法差异处理
- 转换说明和警告

**技术实现**:
- 使用 SQL 解析库（如 `sql-parser-cst`）
- 方言映射规则引擎
- 可选：AI 辅助复杂转换

**优先级**: ⭐⭐⭐⭐ (中高)

---

### 4. 表结构设计器 📐 (计划中)
**路径**: `/tools/database/table-designer`

**功能描述**:
可视化建表工具，拖拽式设计表结构

**核心特性**:
- 添加/删除字段
- 字段类型选择（自动推荐）
- 约束设置（主键、外键、唯一、非空）
- 索引管理
- 生成 CREATE TABLE 语句
- 支持多表设计
- 导出 SQL DDL

**技术实现**:
- 使用 React DnD 或 MUI 可拖拽组件
- 表结构状态管理
- SQL DDL 生成器

**优先级**: ⭐⭐⭐⭐ (中高)

---

### 5. ER 图设计器 🎨 (计划中)
**路径**: `/tools/database/er-designer`

**功能描述**:
在线绘制实体关系图（Entity-Relationship Diagram）

**核心特性**:
- 拖拽添加实体、属性、关系
- 一对一、一对多、多对多关系
- 导出为 SQL DDL
- 导出为图片（PNG、SVG）
- 逆向工程：从 SQL 生成 ER 图

**技术实现**:
- 使用图形库（如 `react-flow`、`mxGraph`、`GoJS`）
- 或者使用 `mermaid` 渲染

**优先级**: ⭐⭐⭐ (中)

---

### 6. 数据库文档生成器 📚 (计划中)
**路径**: `/tools/database/doc-generator`

**功能描述**:
根据 SQL DDL 或数据库连接自动生成文档

**核心特性**:
- 输入 CREATE TABLE 语句
- 生成 Markdown/HTML 格式文档
- 包含表名、字段、类型、约束、说明
- 支持注释提取
- 表关系图表
- 导出为 PDF

**技术实现**:
- SQL 解析
- Markdown 渲染
- HTML to PDF（如 `jspdf`）

**优先级**: ⭐⭐⭐ (中)

---

### 7. SQL 注入检测 🛡️ (计划中)
**路径**: `/tools/database/sql-injection-checker`

**功能描述**:
分析 SQL 语句的安全风险，检测潜在的注入漏洞

**核心特性**:
- 扫描常见注入模式
- 参数化建议
- 安全评分
- 修复建议
- 常见攻击向量库

**技术实现**:
- 正则表达式检测
- SQL 解析分析
- 规则引擎

**优先级**: ⭐⭐⭐⭐ (中高，安全重要)

---

### 8. SQL 差异对比 🔍 (计划中)
**路径**: `/tools/database/sql-diff`

**功能描述**:
比较两个 SQL 语句或表结构的差异

**核心特性**:
- SQL 语句对比（高亮差异）
- 表结构对比
- 生成迁移脚本（ALTER TABLE）
- 数据对比（CSV/JSON）
- 并排显示 + 差异高亮

**技术实现**:
- 使用 `diff` 算法（如 `diff-match-patch`）
- SQL 解析和结构化对比
- 视觉高亮显示

**优先级**: ⭐⭐⭐ (中)

---

### 9. 数据导入导出 📊 (计划中)
**路径**: `/tools/database/data-import-export`

**功能描述**:
CSV/JSON/Excel 与 SQL INSERT 语句互转

**核心特性**:
- **导入**:
  - CSV → SQL INSERT
  - JSON → SQL INSERT
  - Excel → SQL INSERT
  - 自动检测列类型
  - 批量 INSERT 生成

- **导出**:
  - SQL 结果集 → CSV
  - SQL 结果集 → JSON
  - SQL 结果集 → Excel

**技术实现**:
- CSV 解析（`papaparse`）
- Excel 读写（`xlsx`）
- SQL 生成器

**优先级**: ⭐⭐⭐⭐⭐ (高，实用性强)

---

### 10. 测试数据生成器 🎲 (计划中)
**路径**: `/tools/database/mock-data-generator`

**功能描述**:
根据表结构生成 Mock 测试数据

**核心特性**:
- 输入 CREATE TABLE 语句
- 智能识别字段类型和含义
- 生成符合业务逻辑的测试数据
  - 姓名、邮箱、电话、地址
  - 日期范围、数字范围
  - 枚举值
- 批量生成（1-10000 条）
- 输出为 SQL INSERT 或 CSV

**技术实现**:
- 使用 `faker.js` 生成各类数据
- 字段名智能匹配（email → 邮箱格式）
- SQL DDL 解析

**优先级**: ⭐⭐⭐⭐⭐ (高)

---

### 11. SQL 性能优化器 🚀 (计划中)
**路径**: `/tools/database/sql-optimizer`

**功能描述**:
SQL 性能分析、索引推荐、执行计划解释

**核心特性**:
- SQL 语句分析
- 性能评分
- 索引推荐
- 查询优化建议
- EXPLAIN 执行计划可视化
- 常见性能问题检测（N+1、全表扫描）

**技术实现**:
- SQL 解析和分析
- 规则引擎（索引建议）
- AI 辅助优化建议

**优先级**: ⭐⭐⭐⭐ (中高)

---

## 🎯 推荐开发顺序

### 第一批（高价值 + 相对简单）
1. **AI SQL 生成器** - 利用现有 AI 基础设施，用户需求强
2. **数据导入导出** - 实用性极强，技术成熟
3. **测试数据生成器** - 开发者刚需

### 第二批（中等优先级）
4. **表结构设计器** - 提升开发体验
5. **SQL 转换工具** - 多数据库场景常见
6. **SQL 注入检测** - 安全重要

### 第三批（锦上添花）
7. **SQL 差异对比** - 迁移场景
8. **数据库文档生成器** - 文档化需求
9. **ER 图设计器** - 设计阶段工具
10. **SQL 性能优化器** - 进阶功能

---

## 🔗 在线数据库访问 (讨论)

用户提到的"在线访问数据库"涉及后端服务和安全问题：

### 可行方案
1. **SQLite 浏览器**（纯前端）
   - 用户上传 `.sqlite` 文件
   - 使用 `sql.js`（WebAssembly）在浏览器中运行
   - 完全本地，无后端

2. **数据库连接测试工具**
   - 提供连接字符串输入
   - 测试连接是否成功
   - 获取数据库元信息（表列表、版本）
   - **注意**: 需要 CORS 代理或后端支持

3. **只读查询工具**（需后端）
   - 用户提供只读凭证
   - 执行 SELECT 查询
   - 安全限制：禁止 INSERT/UPDATE/DELETE

### 建议
- **优先实现 SQLite 浏览器**（纯前端，安全）
- 其他数据库连接功能需要谨慎评估安全性和合规性

---

## 📊 当前状态

| 工具名称          | 状态   | 路径                                    |
|-------------------|--------|----------------------------------------|
| SQL 格式化        | ✅ 可用 | /tools/database/sql-formatter          |
| AI SQL 生成器     | 📋 计划中 | /tools/database/ai-sql-generator       |
| SQL 转换工具      | 📋 计划中 | /tools/database/sql-converter          |
| 表结构设计器      | 📋 计划中 | /tools/database/table-designer         |
| ER 图设计器       | 📋 计划中 | /tools/database/er-designer            |
| 数据库文档生成    | 📋 计划中 | /tools/database/doc-generator          |
| SQL 注入检测      | 📋 计划中 | /tools/database/sql-injection-checker  |
| SQL 差异对比      | 📋 计划中 | /tools/database/sql-diff               |
| 数据导入导出      | 📋 计划中 | /tools/database/data-import-export     |
| 测试数据生成      | 📋 计划中 | /tools/database/mock-data-generator    |
| SQL 性能优化      | 📋 计划中 | /tools/database/sql-optimizer          |

---

## 🚀 下一步行动

1. 用户确认工具规划和优先级
2. 开始实现第一批工具（AI SQL 生成器、数据导入导出、测试数据生成器）
3. 持续迭代和优化


